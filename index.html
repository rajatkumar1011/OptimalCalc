<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptimalCalc</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for the minimalist, translucent theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Pitch black background */
            overflow: hidden;
        }

        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .brand-label {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.25rem;
            font-weight: 500;
            color: rgba(229, 231, 235, 0.7);
            text-shadow: 0 0 8px rgba(56, 189, 248, 0.3);
            z-index: 20;
        }

        .calculator-container {
            font-family: 'Roboto Mono', monospace;
            background: rgba(17, 24, 39, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(55, 65, 81, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .display-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .ai-button-container {
            display: flex;
            justify-content: flex-end;
            padding: 0 4px 4px;
        }

        .display {
            color: #e5e7eb;
            font-weight: 300;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .display::-webkit-scrollbar { height: 6px; }
        .display::-webkit-scrollbar-track { background: rgba(17, 24, 39, 0.1); border-radius: 10px; }
        .display::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .display::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .display { scrollbar-width: thin; scrollbar-color: #4b5563 rgba(17, 24, 39, 0.1); }

        @keyframes sliding-gradient {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .btn, .angle-mode {
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease-in-out;
            background-color: transparent;
            border: 1px solid rgba(55, 65, 81, 0.7);
        }
        
        .btn::before, .angle-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 300%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.1), rgba(74, 222, 128, 0.1), rgba(244, 114, 182, 0.1), rgba(56, 189, 248, 0.1), transparent);
            animation: sliding-gradient 8s linear infinite;
            z-index: 0;
        }

        .btn:hover, .angle-mode:hover {
            border-color: rgba(96, 106, 123, 0.9);
        }
        .btn:active, .angle-mode:active { 
            transform: scale(0.95);
        }

        .ai-button {
            color: #ffffff;
            padding: 4px 10px;
            font-size: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid rgba(74, 222, 128, 0.5);
            background: linear-gradient(to bottom, rgba(74, 222, 128, 0.5), rgba(74, 222, 128, 0.2));
            box-shadow: 0 1px 2px rgba(0,0,0,0.2), inset 0 1px 1px rgba(255,255,255,0.1);
            text-shadow: 0 -1px 1px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        .ai-button:hover {
             background: linear-gradient(to bottom, rgba(74, 222, 128, 0.6), rgba(74, 222, 128, 0.3));
             border-color: rgba(74, 222, 128, 0.7);
        }
        .ai-button:active {
            transform: scale(0.95);
        }

        .angle-mode {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 0.75rem;
            color: #4ade80;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 6px;
        }

        .btn-operator { color: #38bdf8; }
        .btn-special { color: #f472b6; }
        .btn-sci { color: #4ade80; }
        .btn > span, .ai-button > span, .angle-mode > span {
            position: relative;
            z-index: 1;
        }
        
        .btn-equals { 
            background-color: #38bdf8; 
            color: #0a0a0a; 
            font-weight: bold;
            border-color: #38bdf8;
            box-shadow: 0 0 10px #38bdf8;
        }
        .btn-equals:hover { 
            background-color: #0ea5e9; 
            box-shadow: 0 0 15px #0ea5e9;
        }
        .btn-equals::before {
            display: none;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: rgba(23, 31, 47, 0.9);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(55, 65, 81, 0.5);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        #wordProblemInput {
            background: #111827;
            border: 1px solid #374151;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #374151;
            border-top: 4px solid #4ade80;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2 sm:p-4 text-white">

    <canvas id="background-canvas"></canvas>
    <div class="brand-label">OptimalCalc</div>

    <div class="calculator-container w-full max-w-md rounded-3xl p-4 sm:p-6 space-y-4">
        
        <div class="display-container">
            <div class="ai-button-container">
                <button id="aiSolverButton" class="ai-button"><span>✨ Solve with AI</span></button>
            </div>
            <div id="angleMode" class="angle-mode" onclick="toggleAngleMode()"><span>RAD</span></div>
            <input type="text" id="display" class="display w-full bg-transparent text-right text-3xl sm:text-4xl px-4 py-8 outline-none" readonly placeholder="0">
        </div>

        <div class="grid grid-cols-5 gap-2 sm:gap-3">
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>sin</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>cos</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>tan</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>π</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>e</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>log</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>ln</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>(</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>)</span></button>
            <button class="btn btn-sci text-lg p-3 rounded-2xl"><span>√</span></button>
            <button class="btn btn-special text-xl p-3 rounded-2xl"><span>AC</span></button>
            <button class="btn btn-special text-xl p-3 rounded-2xl"><span>C</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl"><span>xʸ</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl"><span>%</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl"><span>÷</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>7</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>8</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>9</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl col-span-2"><span>×</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>4</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>5</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>6</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl col-span-2"><span>-</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>1</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>2</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>3</span></button>
            <button class="btn btn-operator text-xl p-3 rounded-2xl col-span-2"><span>+</span></button>
            <button class="btn text-xl p-3 rounded-2xl col-span-2"><span>0</span></button>
            <button class="btn text-xl p-3 rounded-2xl"><span>.</span></button>
            <button class="btn btn-equals text-xl p-3 rounded-2xl col-span-2"><span>=</span></button>
        </div>
    </div>

    <!-- AI Solver Modal -->
    <div id="aiModal" class="modal-overlay">
        <div class="modal-content space-y-4">
            <h2 class="text-xl font-bold text-gray-200">Solve a Word Problem</h2>
            <p class="text-sm text-gray-400">Type your word problem below. The AI will convert it into a mathematical expression.</p>
            <textarea id="wordProblemInput" rows="4" class="w-full p-2 rounded-lg" placeholder="e.g., If a car travels 150 miles on 3 gallons of gas, what is its mileage?"></textarea>
            <div id="modal-status" class="text-center h-8"></div>
            <div class="flex justify-end space-x-3">
                <button id="closeModalButton" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-700 transition-colors">Cancel</button>
                <button id="submitProblemButton" class="px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700 transition-colors">✨ Generate Expression</button>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-gray-500 font-sans z-10">
        <p class="mb-3">Made with ❤️ by Rajat Kumar</p>
        <div class="flex justify-center space-x-6">
            <a href="https://www.linkedin.com/in/rajatkumar7/" target="_blank" rel="noopener noreferrer" class="hover:text-sky-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
            <a href="https://github.com/rajatkumar1011" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
        </div>
    </footer>

    <script>
        // --- Animated Background Logic ---
        const canvas = document.getElementById('background-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [];
        let nebula;

        class Star {
            constructor(canvasWidth, canvasHeight) {
                this.x = Math.random() * canvasWidth;
                this.y = Math.random() * canvasHeight;
                this.radius = Math.random() * 1.5 + 0.5;
                this.alpha = Math.random() * 0.7 + 0.3; // Base opacity
                this.twinkleSpeed = Math.random() * 0.05 + 0.01; // Faster twinkle
                this.phase = Math.random() * Math.PI * 2; // Random start phase
            }
            draw(context, tick) {
                const sineValue = Math.sin(tick * this.twinkleSpeed + this.phase);
                const blinkFactor = Math.pow((sineValue + 1) / 2, 4);
                const currentAlpha = this.alpha * blinkFactor;

                context.fillStyle = `rgba(255, 255, 255, ${Math.max(0, currentAlpha)})`;
                context.beginPath();
                context.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                context.fill();
            }
        }

        class Nebula {
            constructor(canvasWidth, canvasHeight) {
                this.x = Math.random() * canvasWidth;
                this.y = Math.random() * canvasHeight;
                this.radius = Math.random() * (canvasWidth / 3) + (canvasWidth / 4);
                this.color1 = 'rgba(56, 189, 248, 0.05)';
                this.color2 = 'rgba(74, 222, 128, 0.05)';
                this.gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                this.gradient.addColorStop(0, this.color1);
                this.gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            }
            draw(context) {
                context.fillStyle = this.gradient;
                context.fillRect(0, 0, context.canvas.width, context.canvas.height);
            }
        }
        
        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars = [];
            const numberOfStars = Math.floor(canvas.width / 8);
            for (let i = 0; i < numberOfStars; i++) {
                stars.push(new Star(canvas.width, canvas.height));
            }
            nebula = new Nebula(canvas.width, canvas.height);
        }

        let tick = 0;
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            nebula.draw(ctx);
            stars.forEach(s => s.draw(ctx, tick));
            tick++;
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', setupCanvas);
        setupCanvas();
        animate();

        // --- Calculator Logic ---
        const display = document.getElementById('display');
        const angleModeElem = document.getElementById('angleMode');
        let currentExpression = '', angleMode = 'RAD';

        function appendToDisplay(v) { currentExpression+=v; updateDisplay(); }
        function appendFunction(f) { currentExpression+=`${f}(`; updateDisplay(); }
        function appendConstant(c) { currentExpression+=c; updateDisplay(); }
        function updateDisplay() { display.value=currentExpression.replace(/\*/g,'×').replace(/\//g,'÷').replace(/sqrt/g,'√'); display.scrollLeft=display.scrollWidth; }
        function clearAll() { currentExpression=''; display.value=''; display.placeholder='0'; }
        function backspace() { currentExpression=currentExpression.slice(0,-1); updateDisplay(); }
        function toggleAngleMode() { angleMode=angleMode==='RAD'?'DEG':'RAD'; angleModeElem.querySelector('span').textContent=angleMode; }

        function calculateResult() {
            if(currentExpression==='') return;
            const sin=(x)=>angleMode==='DEG'?Math.sin(x*Math.PI/180):Math.sin(x);
            const cos=(x)=>angleMode==='DEG'?Math.cos(x*Math.PI/180):Math.cos(x);
            const tan=(x)=>{ if(angleMode==='DEG'&&Math.abs(x%180)===90)return Infinity; if(angleMode==='RAD'&&Math.abs(x%Math.PI)===Math.PI/2)return Infinity; return angleMode==='DEG'?Math.tan(x*Math.PI/180):Math.tan(x); };
            const log=Math.log10, ln=Math.log, sqrt=Math.sqrt;
            let evalExpression=currentExpression.replace(/×/g,'*').replace(/÷/g,'/').replace(/\^/g,'**').replace(/√/g,'sqrt').replace(/π/g,'Math.PI').replace(/e/g,'Math.E');
            try {
                const result=new Function('sin','cos','tan','log','ln','sqrt',`'use strict'; return ${evalExpression}`)(sin,cos,tan,log,ln,sqrt);
                if(result===Infinity){display.value='TOO BIG!';currentExpression='';return;}
                if(result===-Infinity){display.value='TOO SMALL!';currentExpression='';return;}
                if(isNaN(result)){display.value='Error';currentExpression='';return;}
                currentExpression=String(parseFloat(result.toFixed(10))); updateDisplay();
            } catch(e) { console.error("Calc Error:",e); display.value='Error'; currentExpression=''; }
        }

        // Add onclick events to buttons
        document.querySelectorAll('.btn').forEach(button => {
            const value = button.querySelector('span').textContent;
            const actions = {
                'sin': () => appendFunction('sin'), 'cos': () => appendFunction('cos'), 'tan': () => appendFunction('tan'),
                'π': () => appendConstant('π'), 'e': () => appendConstant('e'), 'log': () => appendFunction('log'),
                'ln': () => appendFunction('ln'), '(': () => appendToDisplay('('), ')': () => appendToDisplay(')'),
                '√': () => appendFunction('sqrt'), 'AC': clearAll, 'C': backspace, 'xʸ': () => appendToDisplay('^'),
                '%': () => appendToDisplay('%'), '÷': () => appendToDisplay('/'), '×': () => appendToDisplay('*'),
                '-': () => appendToDisplay('-'), '+': () => appendToDisplay('+'), '=': calculateResult,
            };
            if (actions[value]) {
                button.onclick = actions[value];
            } else {
                button.onclick = () => appendToDisplay(value);
            }
        });

        document.addEventListener('keydown', (e) => {
            const k=e.key;
            if((k>='0'&&k<='9')||k==='.'||k==='('||k===')'){appendToDisplay(k);}
            else if(['+','-','*','/','%','^'].includes(k)){appendToDisplay(k);}
            else if(k==='Enter'||k==='='){e.preventDefault();calculateResult();}
            else if(k==='Backspace'){backspace();}
            else if(k.toLowerCase()==='c'||k==='Escape'){clearAll();}
        });

        // --- Gemini API & Modal Logic ---
        const aiModal = document.getElementById('aiModal');
        const aiSolverButton = document.getElementById('aiSolverButton');
        const closeModalButton = document.getElementById('closeModalButton');
        const submitProblemButton = document.getElementById('submitProblemButton');
        const wordProblemInput = document.getElementById('wordProblemInput');
        const modalStatus = document.getElementById('modal-status');

        aiSolverButton.addEventListener('click', () => aiModal.classList.add('visible'));
        closeModalButton.addEventListener('click', () => aiModal.classList.remove('visible'));
        submitProblemButton.addEventListener('click', handleWordProblem);

        async function handleWordProblem() {
            const problemText = wordProblemInput.value.trim();
            if (!problemText) {
                modalStatus.innerHTML = `<p class="text-red-400">Please enter a problem.</p>`;
                return;
            }

            modalStatus.innerHTML = `<div class="loader mx-auto"></div>`;
            submitProblemButton.disabled = true;

            const prompt = `You are a mathematical assistant. Convert the following word problem into a single, solvable mathematical expression. Provide ONLY the raw expression. For example, for the problem "What is 3 plus 5 divided by 2?", you should only output "(3+5)/2". Problem: "${problemText}"`;
            
            try {
                const expression = await callGemini(prompt);
                currentExpression = expression;
                updateDisplay();
                aiModal.classList.remove('visible');
            } catch (error) {
                console.error('Gemini API Error:', error);
                modalStatus.innerHTML = `<p class="text-red-400">Failed to solve. Please try again.</p>`;
            } finally {
                submitProblemButton.disabled = false;
                wordProblemInput.value = '';
                // Clear status after a few seconds if it's not the loader
                if (!modalStatus.querySelector('.loader')) {
                    setTimeout(() => { modalStatus.innerHTML = ''; }, 3000);
                }
            }
        }
        
        async function callGemini(prompt, retries = 3, delay = 1000) {
            const apiKey = ""; // API key will be injected by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }]
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        // Clean up the response to remove any markdown or extra text
                        return result.candidates[0].content.parts[0].text.replace(/```/g, '').replace(/`/g, '').trim();
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }
    </script>

</body>
</html>
